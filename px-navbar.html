<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="px-navbar-behavior.html">
<!--
## Usage
To use this component in your custom component do the following:
```

```
@element component.html
@blurb px-navbar Element description
@demo demo.html
@homepage index.html
-->
<dom-module id="px-navbar">
  <link rel="stylesheet" href="px-navbar.css">
  <style>
  :host{
    position: absolute;
    top: 0;
    right: 0;
    left: 0;
    z-index: 10;
  }
  :host.fixed-bottom{
    position: fixed;
    bottom: 0;
    right: 0;
    left: 0;
  }
  :host.fixed-top{
    position: fixed;
    top: 0;
    right: 0;
    left: 0;
  }
    :host .navbar--dark ::content .navbar__button,
    :host .navbar--primary ::content  .navbar__button {
      color: #fff !important;
    }

    :host .navbar--dark .navbar__hamburger__icon,
    :host .navbar--primary .navbar__hamburger__icon {
      background-color: #fff !important;
    }

    :host.px-sidebar-open .hamburger-1 {
      -webkit-transform: translate3d(0, 0, 0) rotate(45deg);
      transform: translate3d(0, 0, 0) rotate(45deg);
    }

    :host.px-sidebar-open .hamburger-2 {
      -webkit-transform: translate3d(0, 0, 0) scale(0.1, 1);
      transform: translate3d(0, 0, 0) scale(0.1, 1);
    }

    :host.px-sidebar-open .hamburger-3 {
      -webkit-transform: translate3d(0, 0, 0) rotate(-45deg);
      transform: translate3d(0, 0, 0) rotate(-45deg);
    }


  </style>
  <template>
    <div class="navbar flex flex--middle">

      <!-- back btn-->
      <template is="dom-if" if="{{back}}">
        <div class="left">
          <button class="navbar__button navbar__button--back" on-click="handleBackClick">
            <i class="icon ion-ios-arrow-back"></i>
            <span>{{backBtnLabel}}</span>
          </button>
        </div>
      </template>

      <!-- menu btn-->
      <template is="dom-if" if="{{menu}}">
        <div class="left">
          <button class="navbar__button navbar__hamburger position-relative" on-click="toggleSidebar">
            <i class="icon">
              <span class="navbar__hamburger__icon navbar__hamburger__icon--1"></span>
              <span class="navbar__hamburger__icon navbar__hamburger__icon--2"></span>
              <span class="navbar__hamburger__icon navbar__hamburger__icon--3"></span>
            </i>
          </button>
        </div>
      </template>

      <!-- title/subtitle -->
      <div class="navbar__center">
        <span class="color-auto navbar__center__title" hidden="{{!title}}">{{title}}</span>
        <span class="color-auto navbar__center__subtitle" hidden="{{!subtitle}}">{{subtitle}}</span>
      </div>

      <!-- content -->
      <div class="navbar__content">
        <content></content>
      </div>

    </div>
  </template>
  <script>
    Polymer({
      is: 'px-navbar',
    //  behaviors: [pxNavbarBehavior],
      properties: {
				//The title to display.
				title: {
					type: String
				},
				//The title to display.
				subtitle: {
					type: String
				},
				//The #id of the sidebar container.
				sidebarContainer: {
					type: String
				},
				//The #id of the view container.
				viewContainer: {
					type: String,
					notify: true,
					reflectToAttribute: true
				},
				//To show the menu button or not.
				showMenuBtn: {
					type: Boolean,
					value: true
				},
				//Fix the pxm--navbar to the top.
				fixed: {
					type: Boolean,
					value: false
				},
				//Display open
				open: {
					type: Boolean,
					notify: true,
					observer: '_openChanged',
					value: false
				},
				//Display sidebar on desktop, hide on mobile/tablet
				responsive: {
					type: Boolean,
					value: false
				},
				//Show the menu button
				menu: {
					type: Boolean,
					value: false
				},

				//Use a dynamic navbar
				dynamicNavbar: {
					type: Boolean,
					value: false
				},
				//To show the back button or not.
				back: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},
				//The label for the back button.
				backBtnLabel: {
					type: String,
					value: 'Back'
				},
				//The type of theme to apply.
				theme: {
					type: String,
					notify: true,
					observer: '_themeChanged',
					reflectToAttribute: true
				}
			},
			ready: function() {
				if (this.fixed) {
					this.toggleClass('fixed-top', true);
				}
			},
			attached: function() {
				var _this = this;
				if (_this.sidebarContainer) {
					_this.sidebar = document.getElementById(_this.sidebarContainer);
					_this.sidebar.addEventListener('toggle', function() {
						_this.toggleClass('px-sidebar-open', _this.sidebar.open);
					});
				}



				if (this.viewContainer) {
					this.async(function() {
            _this.viewContainer = document.getElementById(_this.viewContainer);
            if(!_this.title){
              _this.title = _this.viewContainer.getCurrent().title;
            }
            if(_this.viewContainer){
              console.warn('Got views', _this.viewContainer);
              _this.main = _this.viewContainer.getCurrent().main;
  						//	_this.title = _this.views.getCurrent().attr('title');
  						_this.viewContainer.addEventListener('px:view:change', function(e) {
  							//_this.title = e.detail.title;
                _this.debounce('menu', function() {
                  _this.main = (_this.viewContainer.getCurrent().main);
                  _this.back = (_this.viewContainer.getCurrent() !== _this.viewContainer.ViewList[0]);
                  //_this.backBtnText = (_this.views.prevView ? _this.views.prevView.title : '');
                }, 200);
  						});
            }
					});
				}
			},

			//Handle toggling the sidebar.
			toggleSidebar: function(open) {
				console.log('toggleSidebar');
				if (this.sidebar && this.sidebar.toggle) {
					this.sidebar.toggle();
					if (this.viewContainer) {
						this.viewContainer.toggleClass('px-sidebar-open');
					}
				}
			},
			//Handle when the back button is clicked.
			handleBackClick: function() {
				if (this.viewContainer) {
					this.viewContainer.back();
            //this.back = (!this.viewContainer.getCurrent() === this.viewContainer.ViewList[0]);
					//this.title = model.item.title;
				}
			},
			//Handle when a view from the viewContainer is changed.
			handleViewChange: function() {
				if (this.viewContainer) {
					this.back = (this.viewContainer.getCurrent() !== this.viewContainer.main);
				}
			},
			//Toggle the display of the navbar.
			toggle: function(display) {
				this.hidden = !this.hidden;
				this.toggleClass('hidden', this.hidden);
			},
			//Handle getting the current view, if there is a viewContainer
			getCurrent: function() {
				if (this.viewContainer) {
					return this.viewContainer.getCurrent();
				}
			},
			_registerOffclick: function() {
				this.viewContainer.addEventListener('click', this.toggleMenu);
			},
			_deregisterOffclick: function() {
				this.viewContainer.removeEventListener('click', this.toggleMenu);
			},
			_openChanged: function(newVal, oldVal) {
				var _this = this;
				if(_this.sidebar && _this.sidebar.toggle){
					this.debounce('openSidebar', function(){
						_this.sidebar.toggle(newVal);
					}, 100);
				}

			},
			_themeChanged: function(newVal, oldVal) {
				var _this = this;

        if (oldVal) {
          this.toggleClass('navbar--' + oldVal, false, this.$$('.navbar'));
        }
        if(newVal){
          this.toggleClass('navbar--' + newVal, true, this.$$('.navbar'));
        }
			}
    });
  </script>
</dom-module>
